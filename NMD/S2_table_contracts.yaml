# S2 - BigQuery Table Contracts for DiagnosticPro Platform
# Generated: 2025-09-16
# Version: 1.0
# Description: Comprehensive table contracts for 8 core tables with production specifications

# =====================================================
# DATASET CONFIGURATION
# =====================================================
datasets:
  staging:
    name: repair_diagnostics
    project: diagnostic-pro-start-up
    description: Staging dataset for data validation and testing
    location: US
    default_table_expiration_ms: 2592000000  # 30 days

  production:
    name: diagnosticpro_prod
    project: diagnostic-pro-start-up
    description: Production dataset for live diagnostic platform data
    location: US
    default_table_expiration_ms: null  # No automatic expiration

# =====================================================
# CORE TABLE CONTRACTS
# =====================================================
tables:

  # =====================================================
  # 1. USERS TABLE
  # =====================================================
  users:
    description: "Core user authentication and profile data with nested structures"

    datasets:
      staging: repair_diagnostics
      production: diagnosticpro_prod

    load_contract:
      dedupe_strategy: REPLACE_BY_KEY
      natural_keys:
        - email
      idempotency_key:
        - id
        - updated_at
      merge_strategy: UPSERT
      validation_rules:
        - field: email
          type: EMAIL_FORMAT
          pattern: '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
        - field: id
          type: UUID_FORMAT
          pattern: '^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$'
        - field: user_type
          type: ENUM
          values: ['customer', 'technician', 'administrator', 'shop_owner', 'fleet_manager']

    partitioning:
      type: DATE
      column: created_at
      require_filter: false
      expiration_days: null

    clustering:
      columns:
        - user_type
        - email

    columns:
      - name: id
        type: STRING
        nullable: false
        description: "Generated UUID"
        source_tracking: true

      - name: email
        type: STRING
        nullable: false
        description: "User email address"

      - name: email_verified
        type: BOOL
        nullable: true
        description: "Email verification status"

      - name: email_verified_at
        type: TIMESTAMP
        nullable: true
        description: "Email verification timestamp"

      - name: password_hash
        type: STRING
        nullable: false
        description: "Encrypted password hash"

      - name: user_type
        type: STRING
        nullable: false
        description: "User role classification"

      - name: profile
        type: STRUCT
        nullable: true
        description: "User profile information"
        fields:
          - name: first_name
            type: STRING
            nullable: true
          - name: last_name
            type: STRING
            nullable: true
          - name: phone
            type: STRING
            nullable: true
          - name: avatar_url
            type: STRING
            nullable: true
          - name: timezone
            type: STRING
            nullable: true
          - name: language
            type: STRING
            nullable: true
          - name: country
            type: STRING
            nullable: true

      - name: auth
        type: STRUCT
        nullable: true
        description: "Authentication metadata"
        fields:
          - name: mfa_enabled
            type: BOOL
            nullable: true
          - name: mfa_secret
            type: STRING
            nullable: true
          - name: mfa_backup_codes
            type: ARRAY<STRING>
            nullable: true
          - name: failed_login_attempts
            type: INT64
            nullable: true
          - name: locked_until
            type: TIMESTAMP
            nullable: true
          - name: password_reset_token
            type: STRING
            nullable: true
          - name: password_reset_expires
            type: TIMESTAMP
            nullable: true

      - name: metadata
        type: STRUCT
        nullable: true
        description: "User acquisition and tracking metadata"
        fields:
          - name: source
            type: STRING
            nullable: true
          - name: referral_code
            type: STRING
            nullable: true
          - name: utm_campaign
            type: STRING
            nullable: true
          - name: utm_source
            type: STRING
            nullable: true
          - name: utm_medium
            type: STRING
            nullable: true
          - name: custom_fields
            type: JSON
            nullable: true

      - name: created_at
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

      - name: updated_at
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

      - name: last_login_at
        type: TIMESTAMP
        nullable: true

      - name: is_active
        type: BOOL
        nullable: true

      - name: deleted_at
        type: TIMESTAMP
        nullable: true

    source_tracking_fields:
      - name: _source_system
        type: STRING
        description: "Source system identifier"
      - name: _batch_id
        type: STRING
        description: "Data pipeline batch identifier"
      - name: _ingestion_timestamp
        type: TIMESTAMP
        description: "Data ingestion timestamp"

  # =====================================================
  # 2. EQUIPMENT REGISTRY TABLE
  # =====================================================
  equipment_registry:
    description: "Universal equipment registry supporting all equipment types"

    datasets:
      staging: repair_diagnostics
      production: diagnosticpro_prod

    load_contract:
      dedupe_strategy: REPLACE_BY_KEY
      natural_keys:
        - identification_primary
      idempotency_key:
        - id
        - updated_at
      merge_strategy: UPSERT
      validation_rules:
        - field: id
          type: UUID_FORMAT
          pattern: '^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$'
        - field: equipment_category
          type: ENUM
          values: ['automotive', 'heavy_equipment', 'electronics', 'machinery', 'appliances', 'marine', 'agricultural']
        - field: identification_primary
          type: CONDITIONAL_VIN
          condition: "identification_primary_type = 'VIN'"
          pattern: '^[A-HJ-NPR-Z0-9]{17}$'

    partitioning:
      type: DATE
      column: created_at
      require_filter: false
      expiration_days: null

    clustering:
      columns:
        - equipment_category
        - identification_primary_type

    columns:
      - name: id
        type: STRING
        nullable: false
        description: "Generated UUID"
        source_tracking: true

      - name: identification_primary_type
        type: STRING
        nullable: false
        description: "Type of primary identifier (VIN, Serial, Model, etc.)"

      - name: identification_primary
        type: STRING
        nullable: false
        description: "Primary equipment identifier"

      - name: secondary_identifiers
        type: ARRAY<STRUCT>
        nullable: true
        description: "Additional identifiers"
        struct_fields:
          - name: id_type
            type: STRING
          - name: id_value
            type: STRING
          - name: issuing_authority
            type: STRING
          - name: issue_date
            type: DATE
          - name: expiry_date
            type: DATE

      - name: equipment_category
        type: STRING
        nullable: false
        description: "High-level equipment classification"

      - name: equipment_details
        type: STRUCT
        nullable: true
        description: "Detailed equipment information"

      - name: physical
        type: STRUCT
        nullable: true
        description: "Physical characteristics"

      - name: economics
        type: STRUCT
        nullable: true
        description: "Value and economic data"

      - name: power
        type: STRUCT
        nullable: true
        description: "Power and energy specifications"

      - name: usage
        type: STRUCT
        nullable: true
        description: "Usage environment and patterns"

      - name: ownership
        type: STRUCT
        nullable: true
        description: "Ownership and location data"

      - name: connectivity
        type: ARRAY<STRING>
        nullable: true
        description: "Connectivity features"

      - name: smart_features
        type: ARRAY<STRING>
        nullable: true
        description: "Smart/IoT capabilities"

      - name: iot_enabled
        type: BOOL
        nullable: true
        description: "IoT connectivity status"

      - name: compliance
        type: STRUCT
        nullable: true
        description: "Regulatory compliance and recalls"

      - name: custom_fields
        type: JSON
        nullable: true
        description: "Flexible custom data"

      - name: tags
        type: ARRAY<STRING>
        nullable: true
        description: "Equipment tags for categorization"

      - name: created_at
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

      - name: updated_at
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

      - name: deleted_at
        type: TIMESTAMP
        nullable: true

    source_tracking_fields:
      - name: _source_system
        type: STRING
        description: "Source system identifier"
      - name: _batch_id
        type: STRING
        description: "Data pipeline batch identifier"
      - name: _ingestion_timestamp
        type: TIMESTAMP
        description: "Data ingestion timestamp"

  # =====================================================
  # 3. SENSOR TELEMETRY TABLE
  # =====================================================
  sensor_telemetry:
    description: "High-volume sensor telemetry data with time-series optimization"

    datasets:
      staging: repair_diagnostics
      production: diagnosticpro_prod

    load_contract:
      dedupe_strategy: REPLACE_BY_COMPOSITE_KEY
      natural_keys:
        - reading_date
        - equipment_id
        - sensor_id
        - reading_timestamp
      idempotency_key:
        - reading_date
        - equipment_id
        - sensor_id
        - reading_timestamp
        - batch_id
      merge_strategy: APPEND_ONLY
      validation_rules:
        - field: reading_value
          type: NUMERIC_RANGE
          min: -999999.99
          max: 999999.99
        - field: reading_timestamp
          type: TIMESTAMP_RANGE
          min_age_hours: 0
          max_age_hours: 24

    partitioning:
      type: DATE
      column: reading_date
      require_filter: true
      expiration_days: 730  # 2 years retention

    clustering:
      columns:
        - equipment_id
        - sensor_id
        - reading_timestamp

    columns:
      - name: reading_date
        type: DATE
        nullable: false
        description: "Partition key - date of reading"
        source_tracking: true

      - name: equipment_id
        type: STRING
        nullable: false
        description: "Equipment identifier"

      - name: sensor_id
        type: STRING
        nullable: false
        description: "Sensor identifier"

      - name: reading_timestamp
        type: TIMESTAMP
        nullable: false
        description: "Exact timestamp of sensor reading"

      - name: reading_value
        type: NUMERIC
        nullable: false
        description: "Sensor measurement value"

      - name: reading_unit
        type: STRING
        nullable: true
        description: "Unit of measurement"

      - name: sensor_type
        type: STRING
        nullable: true
        description: "Type of sensor"

      - name: quality
        type: STRUCT
        nullable: true
        description: "Data quality metrics"

      - name: context
        type: STRUCT
        nullable: true
        description: "Contextual information"

      - name: ingestion_timestamp
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

      - name: processing_timestamp
        type: TIMESTAMP
        nullable: true

      - name: batch_id
        type: STRING
        nullable: true
        source_tracking: true

    source_tracking_fields:
      - name: _source_system
        type: STRING
        description: "Source system identifier"
      - name: _batch_id
        type: STRING
        description: "Data pipeline batch identifier"
      - name: _ingestion_timestamp
        type: TIMESTAMP
        description: "Data ingestion timestamp"

  # =====================================================
  # 4. MODELS TABLE
  # =====================================================
  models:
    description: "ML model registry and metadata with version control"

    datasets:
      staging: repair_diagnostics
      production: diagnosticpro_prod

    load_contract:
      dedupe_strategy: REPLACE_BY_KEY
      natural_keys:
        - model_name
        - version_info.version_number
      idempotency_key:
        - model_id
        - updated_at
      merge_strategy: UPSERT
      validation_rules:
        - field: model_id
          type: UUID_FORMAT
          pattern: '^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$'
        - field: model_name
          type: STRING_LENGTH
          min_length: 1
          max_length: 255

    partitioning:
      type: DATE
      column: created_at
      require_filter: false
      expiration_days: null

    clustering:
      columns:
        - model_type
        - model_name

    columns:
      - name: model_id
        type: STRING
        nullable: false
        description: "Generated UUID"
        source_tracking: true

      - name: model_name
        type: STRING
        nullable: false
        description: "Model name identifier"

      - name: model_type
        type: STRING
        nullable: true
        description: "Model classification"

      - name: version_info
        type: STRUCT
        nullable: true
        description: "Version control information"

      - name: algorithm
        type: STRING
        nullable: true
        description: "ML algorithm used"

      - name: framework
        type: STRING
        nullable: true
        description: "ML framework"

      - name: hyperparameters
        type: JSON
        nullable: true
        description: "Model hyperparameters"

      - name: features
        type: STRUCT
        nullable: true
        description: "Feature configuration"

      - name: metrics
        type: STRUCT
        nullable: true
        description: "Performance metrics"

      - name: training
        type: STRUCT
        nullable: true
        description: "Training information"

      - name: deployment
        type: STRUCT
        nullable: true
        description: "Deployment configuration"

      - name: artifacts
        type: STRUCT
        nullable: true
        description: "Model artifacts metadata"

      - name: created_at
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

      - name: updated_at
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

    source_tracking_fields:
      - name: _source_system
        type: STRING
        description: "Source system identifier"
      - name: _batch_id
        type: STRING
        description: "Data pipeline batch identifier"
      - name: _ingestion_timestamp
        type: TIMESTAMP
        description: "Data ingestion timestamp"

  # =====================================================
  # 5. FEATURE STORE TABLE
  # =====================================================
  feature_store:
    description: "ML feature store for model training and inference"

    datasets:
      staging: repair_diagnostics
      production: diagnosticpro_prod

    load_contract:
      dedupe_strategy: REPLACE_BY_COMPOSITE_KEY
      natural_keys:
        - feature_date
        - entity_id
        - entity_type
        - feature_set_name
        - feature_set_version
      idempotency_key:
        - feature_date
        - entity_id
        - entity_type
        - feature_set_name
        - feature_set_version
        - computed_at
      merge_strategy: APPEND_ONLY
      validation_rules:
        - field: entity_id
          type: STRING_LENGTH
          min_length: 1
          max_length: 255
        - field: feature_set_name
          type: STRING_LENGTH
          min_length: 1
          max_length: 100

    partitioning:
      type: DATE
      column: feature_date
      require_filter: true
      expiration_days: 90

    clustering:
      columns:
        - entity_type
        - entity_id
        - feature_set_name

    columns:
      - name: feature_date
        type: DATE
        nullable: false
        description: "Partition key - feature computation date"
        source_tracking: true

      - name: entity_id
        type: STRING
        nullable: false
        description: "Entity identifier"

      - name: entity_type
        type: STRING
        nullable: false
        description: "Type of entity"

      - name: numeric_features
        type: ARRAY<NUMERIC>
        nullable: true
        description: "Numeric feature vector"

      - name: categorical_features
        type: ARRAY<STRING>
        nullable: true
        description: "Categorical feature vector"

      - name: feature_set_name
        type: STRING
        nullable: false
        description: "Feature set identifier"

      - name: feature_set_version
        type: STRING
        nullable: false
        description: "Feature set version"

      - name: features
        type: STRUCT
        nullable: true
        description: "Named feature values"

      - name: embedding_vector
        type: ARRAY<FLOAT64>
        nullable: true
        description: "Embedding vectors for similarity"

      - name: data_quality
        type: STRUCT
        nullable: true
        description: "Feature quality metrics"

      - name: computed_at
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

    source_tracking_fields:
      - name: _source_system
        type: STRING
        description: "Source system identifier"
      - name: _batch_id
        type: STRING
        description: "Data pipeline batch identifier"
      - name: _ingestion_timestamp
        type: TIMESTAMP
        description: "Data ingestion timestamp"

  # =====================================================
  # 6. DIAGNOSTIC SESSIONS TABLE
  # =====================================================
  diagnostic_sessions:
    description: "Diagnostic session records with findings and resolutions"

    datasets:
      staging: repair_diagnostics
      production: diagnosticpro_prod

    load_contract:
      dedupe_strategy: REPLACE_BY_KEY
      natural_keys:
        - session_id
      idempotency_key:
        - session_id
        - started_at
      merge_strategy: UPSERT
      validation_rules:
        - field: session_id
          type: UUID_FORMAT
          pattern: '^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$'
        - field: equipment_id
          type: UUID_FORMAT
          pattern: '^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$'

    partitioning:
      type: DATE
      column: session_date
      require_filter: false
      expiration_days: 2555  # 7 years for compliance

    clustering:
      columns:
        - equipment_id
        - session_type

    columns:
      - name: session_id
        type: STRING
        nullable: false
        description: "Generated UUID"
        source_tracking: true

      - name: session_date
        type: DATE
        nullable: false
        description: "Partition key - session date"

      - name: equipment_id
        type: STRING
        nullable: false
        description: "Equipment being diagnosed"

      - name: technician_id
        type: STRING
        nullable: true
        description: "Technician performing diagnosis"

      - name: customer_id
        type: STRING
        nullable: true
        description: "Customer requesting service"

      - name: shop_id
        type: STRING
        nullable: true
        description: "Shop performing service"

      - name: session_type
        type: STRING
        nullable: true
        description: "Type of diagnostic session"

      - name: symptoms
        type: ARRAY<STRUCT>
        nullable: true
        description: "Reported symptoms"

      - name: diagnostic_codes
        type: ARRAY<STRUCT>
        nullable: true
        description: "Diagnostic trouble codes found"

      - name: tests_performed
        type: ARRAY<STRUCT>
        nullable: true
        description: "Tests conducted during session"

      - name: findings
        type: STRUCT
        nullable: true
        description: "Diagnostic findings"

      - name: recommendations
        type: ARRAY<STRUCT>
        nullable: true
        description: "Recommended actions"

      - name: resolution
        type: STRUCT
        nullable: true
        description: "Resolution actions taken"

      - name: media
        type: ARRAY<STRUCT>
        nullable: true
        description: "Media attachments"

      - name: started_at
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

      - name: completed_at
        type: TIMESTAMP
        nullable: true

      - name: duration_minutes
        type: INT64
        nullable: true
        description: "Session duration in minutes"

    source_tracking_fields:
      - name: _source_system
        type: STRING
        description: "Source system identifier"
      - name: _batch_id
        type: STRING
        description: "Data pipeline batch identifier"
      - name: _ingestion_timestamp
        type: TIMESTAMP
        description: "Data ingestion timestamp"

  # =====================================================
  # 7. PARTS INVENTORY TABLE
  # =====================================================
  parts_inventory:
    description: "Parts inventory and supply chain management"

    datasets:
      staging: repair_diagnostics
      production: diagnosticpro_prod

    load_contract:
      dedupe_strategy: REPLACE_BY_KEY
      natural_keys:
        - part_number
      idempotency_key:
        - part_id
        - updated_at
      merge_strategy: UPSERT
      validation_rules:
        - field: part_id
          type: UUID_FORMAT
          pattern: '^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$'
        - field: part_number
          type: STRING_LENGTH
          min_length: 1
          max_length: 100

    clustering:
      columns:
        - part_number

    columns:
      - name: part_id
        type: STRING
        nullable: false
        description: "Generated UUID"
        source_tracking: true

      - name: part_number
        type: STRING
        nullable: false
        description: "Unique part number"

      - name: part_info
        type: STRUCT
        nullable: true
        description: "Part identification details"

      - name: availability
        type: ARRAY<STRUCT>
        nullable: true
        description: "Availability by location"

      - name: suppliers
        type: ARRAY<STRUCT>
        nullable: true
        description: "Supplier information"

      - name: compatible_equipment
        type: ARRAY<STRING>
        nullable: true
        description: "Compatible equipment IDs"

      - name: compatible_models
        type: ARRAY<STRUCT>
        nullable: true
        description: "Compatible vehicle/equipment models"

      - name: pricing
        type: STRUCT
        nullable: true
        description: "Pricing information"

      - name: specifications
        type: STRUCT
        nullable: true
        description: "Physical specifications"

      - name: metrics
        type: STRUCT
        nullable: true
        description: "Performance and demand metrics"

      - name: created_at
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

      - name: updated_at
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

    source_tracking_fields:
      - name: _source_system
        type: STRING
        description: "Source system identifier"
      - name: _batch_id
        type: STRING
        description: "Data pipeline batch identifier"
      - name: _ingestion_timestamp
        type: TIMESTAMP
        description: "Data ingestion timestamp"

  # =====================================================
  # 8. MAINTENANCE PREDICTIONS TABLE
  # =====================================================
  maintenance_predictions:
    description: "Predictive maintenance recommendations and scheduling"

    datasets:
      staging: repair_diagnostics
      production: diagnosticpro_prod

    load_contract:
      dedupe_strategy: REPLACE_BY_KEY
      natural_keys:
        - prediction_id
      idempotency_key:
        - prediction_id
        - generated_at
      merge_strategy: UPSERT
      validation_rules:
        - field: prediction_id
          type: UUID_FORMAT
          pattern: '^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$'
        - field: equipment_id
          type: UUID_FORMAT
          pattern: '^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$'

    partitioning:
      type: DATE
      column: prediction_date
      require_filter: false
      expiration_days: 365

    clustering:
      columns:
        - equipment_id

    columns:
      - name: prediction_id
        type: STRING
        nullable: false
        description: "Generated UUID"
        source_tracking: true

      - name: prediction_date
        type: DATE
        nullable: false
        description: "Partition key - prediction date"

      - name: equipment_id
        type: STRING
        nullable: false
        description: "Equipment needing maintenance"

      - name: predictions
        type: ARRAY<STRUCT>
        nullable: true
        description: "Failure predictions for components"

      - name: maintenance_actions
        type: ARRAY<STRUCT>
        nullable: true
        description: "Recommended maintenance actions"

      - name: risk_assessment
        type: STRUCT
        nullable: true
        description: "Overall risk assessment"

      - name: model_metadata
        type: STRUCT
        nullable: true
        description: "ML model metadata"

      - name: generated_at
        type: TIMESTAMP
        nullable: true
        default: CURRENT_TIMESTAMP()
        source_tracking: true

    source_tracking_fields:
      - name: _source_system
        type: STRING
        description: "Source system identifier"
      - name: _batch_id
        type: STRING
        description: "Data pipeline batch identifier"
      - name: _ingestion_timestamp
        type: TIMESTAMP
        description: "Data ingestion timestamp"

# =====================================================
# GLOBAL CONFIGURATION
# =====================================================
global_settings:

  # Source tracking configuration
  source_tracking:
    enabled: true
    required_fields:
      - _source_system
      - _batch_id
      - _ingestion_timestamp
    default_source_system: "diagnostic_platform_v1"

  # Data quality standards
  data_quality:
    null_check_enabled: true
    format_validation_enabled: true
    range_validation_enabled: true
    duplicate_detection_enabled: true

  # Performance optimization
  performance:
    clustering_enabled: true
    partitioning_required_for_large_tables: true
    partition_filter_enforcement: true
    automatic_expiration_enabled: true

  # Compliance and retention
  compliance:
    data_retention_policy: "automotive_regulatory"
    audit_logging_enabled: true
    change_tracking_enabled: true

  # Cost optimization
  cost_optimization:
    partition_pruning_enabled: true
    clustering_for_query_optimization: true
    automatic_table_expiration: true
    materialized_views_for_analytics: true

# =====================================================
# VALIDATION RULES
# =====================================================
validation_rules:

  # Standard format patterns
  formats:
    UUID_FORMAT: '^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$'
    EMAIL_FORMAT: '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    VIN_FORMAT: '^[A-HJ-NPR-Z0-9]{17}$'
    DTC_FORMAT: '^[PBCU]\d{4}$'

  # Business rule enums
  enums:
    user_types: ['customer', 'technician', 'administrator', 'shop_owner', 'fleet_manager']
    equipment_categories: ['automotive', 'heavy_equipment', 'electronics', 'machinery', 'appliances', 'marine', 'agricultural']
    session_statuses: ['pending', 'in_progress', 'completed', 'cancelled']
    risk_levels: ['low', 'medium', 'high', 'critical']

  # Data quality thresholds
  quality_thresholds:
    completeness_minimum: 0.95
    freshness_maximum_hours: 24
    anomaly_score_threshold: 0.8

# =====================================================
# DEPLOYMENT SPECIFICATIONS
# =====================================================
deployment:

  # Staging deployment
  staging:
    dataset: repair_diagnostics
    validation_level: STRICT
    data_retention_days: 30
    auto_cleanup_enabled: true

  # Production deployment
  production:
    dataset: diagnosticpro_prod
    validation_level: STRICT
    data_retention_policy: BY_TABLE
    backup_enabled: true
    monitoring_enabled: true

  # Migration strategy
  migration:
    strategy: BLUE_GREEN
    rollback_enabled: true
    validation_queries_required: true
    performance_testing_required: true

# =====================================================
# MONITORING AND ALERTING
# =====================================================
monitoring:

  # Table health metrics
  health_checks:
    - metric: row_count_growth
      threshold: 1000000
      frequency: hourly
    - metric: partition_size
      threshold: 10GB
      frequency: daily
    - metric: query_performance
      threshold: 30s
      frequency: continuous

  # Data quality monitoring
  quality_monitoring:
    - check: null_percentage
      threshold: 5%
      frequency: daily
    - check: duplicate_percentage
      threshold: 1%
      frequency: daily
    - check: format_compliance
      threshold: 99%
      frequency: hourly

  # Cost monitoring
  cost_monitoring:
    - metric: daily_scan_cost
      threshold: 100USD
      frequency: daily
    - metric: storage_growth
      threshold: 1TB
      frequency: weekly

# =====================================================
# DOCUMENTATION METADATA
# =====================================================
metadata:
  version: "1.0"
  created_date: "2025-09-16"
  created_by: "database-schema-architect"
  description: "Comprehensive table contracts for DiagnosticPro platform BigQuery schema"

  # Table relationship mapping
  relationships:
    - parent: users
      child: equipment_registry
      type: ownership
      field: ownership.owner_id

    - parent: equipment_registry
      child: sensor_telemetry
      type: monitoring
      field: equipment_id

    - parent: equipment_registry
      child: diagnostic_sessions
      type: diagnosis
      field: equipment_id

    - parent: equipment_registry
      child: feature_store
      type: features
      field: entity_id
      condition: entity_type='equipment'

    - parent: equipment_registry
      child: maintenance_predictions
      type: predictions
      field: equipment_id

    - parent: models
      child: maintenance_predictions
      type: model_usage
      field: predictions.model_id

  # Change log
  change_log:
    - version: "1.0"
      date: "2025-09-16"
      changes: "Initial comprehensive table contracts creation"
      impact: "Establishes foundation for BigQuery schema management"