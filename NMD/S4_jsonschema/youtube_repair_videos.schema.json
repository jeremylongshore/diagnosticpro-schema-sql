{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://diagnosticpro.com/schemas/youtube_repair_videos.json",
  "title": "YouTube Repair Videos",
  "description": "YouTube videos with repair and diagnostic content schema",
  "type": "object",
  "required": [
    "source",
    "import_timestamp"
  ],
  "properties": {
    "video_id": {
      "type": ["string", "null"],
      "pattern": "^[a-zA-Z0-9_-]{11}$",
      "description": "YouTube video ID (11 characters)"
    },
    "url": {
      "type": ["string", "null"],
      "pattern": "^https?://(www\\.)?(youtube\\.com/watch\\?v=|youtu\\.be/)[a-zA-Z0-9_-]{11}",
      "description": "Full YouTube video URL"
    },
    "title": {
      "type": ["string", "null"],
      "minLength": 5,
      "maxLength": 200,
      "description": "Video title (YouTube limit is ~100 chars, allowing extra)"
    },
    "description": {
      "type": ["string", "null"],
      "maxLength": 5000,
      "description": "Video description (YouTube limit)"
    },
    "channel": {
      "type": ["string", "null"],
      "minLength": 1,
      "maxLength": 100,
      "description": "YouTube channel name"
    },
    "channel_id": {
      "type": ["string", "null"],
      "pattern": "^UC[a-zA-Z0-9_-]{22}$",
      "description": "YouTube channel ID (starts with UC)"
    },
    "duration_seconds": {
      "type": ["integer", "null"],
      "minimum": 1,
      "maximum": 43200,
      "description": "Video duration in seconds (max 12 hours)"
    },
    "view_count": {
      "type": ["integer", "null"],
      "minimum": 0,
      "description": "Number of views"
    },
    "like_count": {
      "type": ["integer", "null"],
      "minimum": 0,
      "description": "Number of likes"
    },
    "comment_count": {
      "type": ["integer", "null"],
      "minimum": 0,
      "description": "Number of comments"
    },
    "published_at": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "When video was published on YouTube"
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string",
        "maxLength": 100
      },
      "maxItems": 500,
      "description": "Video tags/keywords"
    },
    "category": {
      "type": ["string", "null"],
      "enum": [
        "autos_vehicles",
        "howto_style",
        "education",
        "science_technology",
        "entertainment",
        "people_blogs",
        "other"
      ],
      "description": "YouTube category"
    },
    "language": {
      "type": ["string", "null"],
      "pattern": "^[a-z]{2}(-[A-Z]{2})?$",
      "description": "Video language (ISO 639-1 with optional region)"
    },
    "transcript": {
      "type": "object",
      "properties": {
        "has_transcript": {
          "type": ["boolean", "null"],
          "description": "Whether transcript is available"
        },
        "transcript_text": {
          "type": ["string", "null"],
          "maxLength": 100000,
          "description": "Full transcript text"
        },
        "auto_generated": {
          "type": ["boolean", "null"],
          "description": "Whether transcript is auto-generated"
        },
        "language": {
          "type": ["string", "null"],
          "pattern": "^[a-z]{2}(-[A-Z]{2})?$",
          "description": "Transcript language"
        }
      },
      "additionalProperties": false
    },
    "repair_content": {
      "type": "object",
      "properties": {
        "repair_type": {
          "type": ["string", "null"],
          "enum": [
            "diagnostic",
            "engine_repair",
            "transmission_repair",
            "brake_repair",
            "electrical_repair",
            "body_repair",
            "maintenance",
            "modification",
            "troubleshooting",
            "replacement",
            "rebuild"
          ],
          "description": "Type of repair demonstrated"
        },
        "difficulty_level": {
          "type": ["string", "null"],
          "enum": ["beginner", "intermediate", "advanced", "professional"],
          "description": "Skill level required"
        },
        "estimated_time": {
          "type": ["string", "null"],
          "maxLength": 50,
          "description": "Estimated time to complete repair"
        },
        "tools_required": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 100
          },
          "description": "Tools required for the repair"
        },
        "parts_mentioned": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 100
          },
          "description": "Parts mentioned in the video"
        },
        "cost_estimate": {
          "type": ["number", "null"],
          "minimum": 0,
          "maximum": 50000,
          "description": "Estimated repair cost in USD"
        }
      },
      "additionalProperties": false
    },
    "vehicle_info": {
      "type": "object",
      "properties": {
        "make": {
          "type": ["string", "null"],
          "maxLength": 50,
          "description": "Vehicle make"
        },
        "model": {
          "type": ["string", "null"],
          "maxLength": 50,
          "description": "Vehicle model"
        },
        "year": {
          "type": ["integer", "null"],
          "minimum": 1980,
          "maximum": 2030,
          "description": "Vehicle year"
        },
        "engine": {
          "type": ["string", "null"],
          "maxLength": 100,
          "description": "Engine specification"
        },
        "applicable_years": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 1980,
            "maximum": 2030
          },
          "description": "Years this repair applies to"
        }
      },
      "additionalProperties": false
    },
    "diagnostic_codes": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "pattern": "^[PBCU]\\d{4}$",
            "description": "Diagnostic trouble code"
          },
          "mention_timestamp": {
            "type": ["integer", "null"],
            "minimum": 0,
            "description": "Timestamp in video when code is mentioned (seconds)"
          }
        },
        "required": ["code"],
        "additionalProperties": false
      },
      "description": "Diagnostic codes mentioned in video"
    },
    "quality_metrics": {
      "type": "object",
      "properties": {
        "video_quality": {
          "type": ["string", "null"],
          "enum": ["240p", "360p", "480p", "720p", "1080p", "1440p", "2160p"],
          "description": "Video resolution quality"
        },
        "audio_quality": {
          "type": ["string", "null"],
          "enum": ["poor", "fair", "good", "excellent"],
          "description": "Audio quality assessment"
        },
        "instructional_clarity": {
          "type": ["number", "null"],
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "How clear the instructions are (0-1)"
        },
        "technical_accuracy": {
          "type": ["number", "null"],
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Technical accuracy score (0-1)"
        }
      },
      "additionalProperties": false
    },
    "engagement_metrics": {
      "type": "object",
      "properties": {
        "like_ratio": {
          "type": ["number", "null"],
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Like to total engagement ratio"
        },
        "comment_to_view_ratio": {
          "type": ["number", "null"],
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Comments per view ratio"
        },
        "average_watch_time": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Average watch time in seconds"
        },
        "retention_rate": {
          "type": ["number", "null"],
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Viewer retention rate"
        }
      },
      "additionalProperties": false
    },
    "source": {
      "type": "string",
      "pattern": "^youtube_[a-z0-9_]+$",
      "description": "YouTube scraper source identifier"
    },
    "source_metadata": {
      "type": "object",
      "properties": {
        "scraper_version": {
          "type": ["string", "null"],
          "maxLength": 20,
          "description": "Version of scraper used"
        },
        "api_quota_used": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "YouTube API quota units consumed"
        },
        "collection_method": {
          "type": ["string", "null"],
          "enum": ["api", "web_scraping", "bulk_download", "manual"],
          "description": "Method used to collect the data"
        },
        "last_updated_on_youtube": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "When video was last updated on YouTube"
        }
      },
      "additionalProperties": false
    },
    "import_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "When the record was imported into database"
    },
    "data_quality": {
      "type": "object",
      "properties": {
        "extraction_confidence": {
          "type": ["number", "null"],
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Confidence in data extraction accuracy (0-1)"
        },
        "content_relevance": {
          "type": ["number", "null"],
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Relevance to automotive repair (0-1)"
        },
        "is_educational": {
          "type": ["boolean", "null"],
          "description": "Whether video is educational/instructional"
        },
        "contains_advertisement": {
          "type": ["boolean", "null"],
          "description": "Whether video contains advertising"
        },
        "validation_status": {
          "type": ["string", "null"],
          "enum": ["pending", "validated", "rejected", "needs_review"],
          "description": "Manual validation status"
        }
      },
      "additionalProperties": false
    },
    "is_active": {
      "type": ["boolean", "null"],
      "default": true,
      "description": "Whether video is still available and active"
    },
    "is_monetized": {
      "type": ["boolean", "null"],
      "description": "Whether video is monetized"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when record was created"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when record was last updated"
    }
  },
  "additionalProperties": false,
  "allOf": [
    {
      "description": "Video ID required when title provided",
      "if": {
        "properties": {
          "title": {"type": "string"}
        }
      },
      "then": {
        "properties": {
          "video_id": {
            "type": "string"
          }
        }
      }
    },
    {
      "description": "URL and video_id consistency",
      "if": {
        "properties": {
          "video_id": {"type": "string"},
          "url": {"type": "string"}
        }
      },
      "then": {
        "properties": {
          "url": {
            "pattern": "^https?://(www\\.)?(youtube\\.com/watch\\?v=|youtu\\.be/)[a-zA-Z0-9_-]{11}"
          }
        }
      }
    },
    {
      "description": "Engagement ratio validations",
      "if": {
        "properties": {
          "engagement_metrics": {
            "properties": {
              "like_ratio": {"type": "number"}
            }
          }
        }
      },
      "then": {
        "properties": {
          "engagement_metrics": {
            "properties": {
              "like_ratio": {
                "minimum": 0,
                "maximum": 1
              }
            }
          }
        }
      }
    },
    {
      "description": "Duration and average watch time consistency",
      "if": {
        "properties": {
          "duration_seconds": {"type": "integer"},
          "engagement_metrics": {
            "properties": {
              "average_watch_time": {"type": "integer"}
            }
          }
        }
      },
      "then": {
        "properties": {
          "engagement_metrics": {
            "properties": {
              "average_watch_time": {
                "type": "integer"
              }
            }
          }
        }
      }
    }
  ]
}